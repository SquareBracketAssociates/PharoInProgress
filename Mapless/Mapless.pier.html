<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <title>{Pharo For the Entreprise}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Highlight js -->
    <link rel="stylesheet" href="../_support/html/highlightjs/styles/default.css">
    <link rel="stylesheet" href="../_support/html/css/highlight-commands.css">
    <script src="../_support/html/highlightjs/highlight.pack.js"></script>
    <script src="../_support/html/js/highlight-commands.js"></script>

    <!-- Bootstrap -->
    <link href="../_support/html/css/bootstrap.min.css" rel="stylesheet">
    <link href="../_support/html/css/bootstrap-theme.min.css" rel="stylesheet">
    <style>
        .container { max-width: 55em; }
    </style>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <div class="container text-justify">
      <h2>Mapless</h2><p>Obscenely simple persistence for Smalltalk. Mapless is a small framework for storing objects in a key <code>-&gt;</code> data fashion (i.e., noSQL databases) without requiring any kind of object-data map. So far only MongoDB is supported. And Redis can be used for reactivity and cache joy.
Mapless is developed by Sebastian Sastre and the code project is located at: <a href="https://github.com/sebastianconcept/Mapless">https://github.com/sebastianconcept/Mapless</a></p>
<h3>1. Motivation</h3>
<p>&quot;I wanted to persist objects with low friction and low maintenance but high scaling and availability capabilities so Mapless is totally biased towards that. This framework is what I came up with after incorporating my experience with Aggregate in airflowing.&quot; Sebastian</p>
<p>There is no instVars. There is no accessors. There is no object-mapping impedance. Only persistence.</p>
<h3>2. Loading it in your image</h3>
<p>Take your open image and click for a menu, then tools, then Configuration Browser and search for Mapless. Click Install Stable Version</p>
<p>Or use this snippet to load it into your Pharo image:</p>
<p><figure><pre><code class="smalltalk">Gofer it 
    smalltalkhubUser: 'Pharo'
    project: 'MetaRepoForPharo30'; 
    package: 'ConfigurationOfMapless';
    load.

(Smalltalk at: #ConfigurationOfMapless) load</code></pre><figcaption></figcaption></figure></p>
<h3>3. How does it look?</h3>
<p>You can store and retrieve your Mapless models on MongoDB like a breeze. Here is a couple of snippets used while developing tasks (<a href="http://tasks.flowingconcept.com/service/">http://tasks.flowingconcept.com/service/</a>)</p>
<h4>3.1. Getting the connection</h4>
<p><figure><pre><code class="smalltalk">odb := MongoPool instance databaseAt: 'Reactive'.</code></pre><figcaption></figcaption></figure></p>
<h4>3.2.  Create a new model</h4>
<p>Just subclass <code>MaplessModel</code>. Here we use a <code>RTask</code> model:</p>
<p><figure><pre><code class="smalltalk">task := RTask new description: 'Try Mapless'; beIncomplete.</code></pre><figcaption></figcaption></figure></p>
<h4>3.3.  Save it</h4>
<p>In Mapless you do things using a <code>do:</code> closure which Mapless uses to automatically discern which MongoDB database and collection has to be used. It also will know if it needs to do an insert or an update. As a bonus, you get the collection and the database created lazily.</p>
<p>Want to save something? Zero bureaucracy, just tell that to the model:</p>
<p><figure><pre><code class="smalltalk">odb do:[task save].</code></pre><figcaption></figcaption></figure></p>
<p>At <a href="http://www.airflowing.com">http://www.airflowing.com</a> we call this the low-friction way to do it.</p>
<h4>3.4.  Fetching stuff</h4>
<p>Getting all models of a given class:</p>
<p><figure><pre><code class="smalltalk">odb do:[RTask findAll].</code></pre><figcaption></figcaption></figure></p>

<h4>3.5.  Getting a specific model:</h4>
<p><figure><pre><code class="smalltalk">odb do:[RTask findAt: 'c472099f-79b9-8ea2-d61f-e5df34b3ed06'].</code></pre><figcaption></figcaption></figure></p>
<p>For getting efficiently a (sub)group of models, you write your own Mapless class side getters. They should act on the MongoDB indices with the parameters of your query. You'll get your models in a breeze:</p>
<p><figure><pre><code class="smalltalk">odb do:[RTask findAtUsername: 'awesomeguy'].</code></pre><figcaption></figcaption></figure></p>
<h4>3.6.  Adding something to a model</h4>
<p>You can use Mapless models pretending they are prototypical like in Self or Javascript objects. No instVars. No setters. No getters. All just works:</p>
<p><figure><pre><code class="smalltalk">odb do:[
    task 
        deadline: Date tomorrow; 
        notes: 'Wonder how it feels to use this thing, hmm...';
        save].</code></pre><figcaption></figcaption></figure></p>
<h3>4. Need composition?</h3>
<p>Of course you do! The only thing you need is to save the children first</p>
<p><figure><pre><code class="smalltalk">odb do:[ |anAlert|
  anAlert := RAlert new 
                duration: 24 hours;
                message: 'You will miss the target!';
                save.
    task 
        alert: anAlert;
        save].</code></pre><figcaption></figcaption></figure></p>
<p>This is what we call low-maintenance.</p>
<h4>4.1.  Navigating the object graph</h4>
<p>Mapless embraces an aggressive lazy approach. When you query for models you get them. But if they are composed by other (sub)Mapless, they are going to be references and only reify into the proper Mapless model if you send them a message and you can do this with arbitrary depth:</p>
<p><figure><pre><code class="smalltalk">odb do:[task alert message].   

odb do:[task alert class = MaplessReference].  &quot;&lt;- true&quot;   

odb do:[task alert description].  &quot;&lt;- 'You will miss the target!'&quot;   </code></pre><figcaption></figcaption></figure></p>

<h3>5.  Persisting a different model</h3>
<p>So you now need to store a different kind of models, say List or User or anything, how you proceed?</p>
<p>This is what happens to you with Mapless:</p>
<ul><li>Create a subclass for them</li><li>Know what attributes they will need in advance</li><li>Create its attributes' instVars</li><li>Make accessors for them</li><li>Elegantly map them so it all fits in the database</li><li>Patiently re-map them every time you need to change its design</li><li>Profit</li></ul>
<h4>5.1.  How does it look? on Redis</h4>
<p>Redis is interesting for:</p>
<ul><li>Caching. It will hold the data in RAM so you get great response times.</li><li>Reactivity. Mapless uses Redis PUB/SUB feature to observe/react models among N Pharo worker images enabling horizontal scaling.</li></ul><p>Here is a workspace for Redis based Mapless models:</p>
<p><figure><pre><code class="smalltalk">redis := RedisPool instance.
guy := MaplessRedisDummyPerson new
            firstName: 'John';
            lastName: 'Q';
            yourself.               
redis do:[:c| guy save].
redis do:[:c| MaplessRedisDummyPerson findAt: '38skolpqv0y9lazmk772hmsed'].
redis do:[:c| (MaplessRedisDummyPerson findAt: '38skolpqv0y9lazmk772hmsed') lastName].</code></pre><figcaption></figcaption></figure></p>

<h3>6.  State and Future </h3>
<p>This code is considered alpha. Check its tests. Contribute!</p>
<p>Contributions are very welcomed, send that push request and hopefully we can review it together.</p>
<p>Direction?</p>
<p>We would love to see more and better tests and iterate the reactive features so you can ultimately get an a model in one image being observed in regard to one event by something in another image and that something reacting upon that event. Broadcast and multicast of events would be also a nice feat and not too hard to do. Have design suggestions? Let's have a chat!</p>
<p>For MongoDB-based Mapless, a nice feature would be to have <code>UserModel ensureIndex: '{ key1: 1, key2: -1 }'</code>
We actually are starting to think Amber and localStorage but that's more hush hush at this point. Oh gee! we already blown it!</p>
<p>Remember to get Pharo Smalltalk it is as easy as running in your terminal:</p>
<p><figure><pre><code class="smalltalk">wget -O- get.pharo.org/30+vm | bash</code></pre><figcaption></figcaption></figure></p>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://code.jquery.com/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="../_support/html/js/bootstrap.min.js"></script>

    <!-- Syntax highlighting of code blocks -->
    <script>hljs.initHighlightingOnLoad();</script>

  </body>
</html>
